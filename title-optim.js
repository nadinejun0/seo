const tags=[];function switchTab(t,e){document.querySelectorAll(".tab-content").forEach((t=>{t.classList.remove("active")})),document.getElementById(t).classList.add("active"),document.querySelectorAll(".tab").forEach((t=>{t.classList.remove("active")})),e.classList.add("active")}document.addEventListener("DOMContentLoaded",(function(){const t=document.getElementById("tagContainer"),e=document.getElementById("tagInput"),n=document.getElementById("addTagBtn"),o=document.getElementById("currentTitle"),i=document.getElementById("titleCharCount"),s=document.getElementById("optimizeBtn"),l=document.getElementById("resultsContainer");function r(t){if(!t)return!1;if(t.length>20)return alert(`Tag "${t}" exceeds the 20 character limit and was not added.`),!1;return!tags.some((e=>e.toLowerCase()===t.toLowerCase()))||(alert(`Tag "${t}" is already in your list.`),!1)}function a(){const t=e.value.trim();if(!t)return;const n=t.split(",").map((t=>t.trim())).filter((t=>t));let o=0;for(let t of n)r(t)&&(tags.push(t),o++);o>0&&(c(),e.value="")}function c(){t.innerHTML="",tags.forEach(((e,n)=>{const o=document.createElement("div");o.className="tag";const i=document.createElement("span");i.textContent=e;const s=document.createElement("button");s.textContent="Ã—",s.onclick=function(){tags.splice(n,1),c()},o.appendChild(i),o.appendChild(s),t.appendChild(o)}))}function u(t){return(t.match(/,/g)||[]).length}function d(t){const e=["and","the","a","an","that","this","for","with","by","of","to","in","on","at"];return t.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter((t=>t.length>2&&!e.includes(t)))}function h(t){return t.split(/,\s*/).map((t=>function(t){const e=["a","an","the","and","but","or","for","nor","on","at","to","from","by","in","of","with","as"];return t.split(" ").map(((t,n)=>t.match(/^[a-z].*[A-Z]/)?t:0===n?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():e.includes(t.toLowerCase())?t.toLowerCase():t.charAt(0).toUpperCase()+t.slice(1).toLowerCase())).join(" ")}(t))).join(", ")}function g(t,e,n){const o=t.slice(0,Math.min(4,t.length)),i=t.slice(Math.min(4,t.length));let s=o.join(", "),l="";if(i.length>0&&(l=`, ${i.join(", ")}`),(s+l).length<90&&n.length>0){const t=["Unique","Custom","Handmade","Perfect","High Quality"].filter((t=>!s.toLowerCase().includes(t.toLowerCase())));t.length>0&&(l+=`, ${t[0]} Gift`)}return{title:h(s+l),explanation:"Standard template with most important keywords first"}}function m(t,e,n){const o=["Perfect Gift","Home Decor","Special Occasion","Unique Present"];let i=`${o[Math.floor(Math.random()*o.length)]}, ${t.slice(0,Math.min(3,t.length)).join(", ")}`;const s=t.slice(Math.min(3,t.length));let l="";s.length>0&&(l=`, ${s.join(", ")}`);return{title:h(i+l),explanation:"Benefit-first template highlighting a use case or occasion"}}function f(t,e,n){const o=["Wood","Ceramic","Metal","Glass","Leather","Cotton","Wool","Acrylic","Vinyl"];let i=null;for(const n of o)if(t.some((t=>t.toLowerCase().includes(n.toLowerCase())))||e.some((t=>t.toLowerCase()===n.toLowerCase()))){i=n;break}if(!i)return null;const s=t.find((t=>t.split(" ").length>1))||t[0];let l=`${i} ${s}`;l.toLowerCase()!==s.toLowerCase()?l+=", ":l=s+", ";const r=t.filter((t=>t.toLowerCase()!==s.toLowerCase()&&!t.toLowerCase().includes(i.toLowerCase()))),a=r.slice(0,Math.min(3,r.length)).join(", "),c=r.slice(Math.min(3,r.length)).join(", ");return{title:h(l+a+(c?`, ${c}`:"")),explanation:"Material-first template emphasizing product construction"}}function p(t,e,n){const o=["Modern","Rustic","Vintage","Minimalist","Bohemian","Industrial","Traditional","Contemporary"];let i=null;for(const s of o)if(t.some((t=>t.toLowerCase().includes(s.toLowerCase())))||e.some((t=>t.toLowerCase()===s.toLowerCase()))||n.some((t=>t.toLowerCase()===s.toLowerCase()))){i=s;break}if(!i)return null;const s=t.find((t=>t.split(" ").length>1))||t[0];let l=`${i} ${s}`;l.toLowerCase()!==s.toLowerCase()?l+=", ":l=s+", ";const r=t.filter((t=>t.toLowerCase()!==s.toLowerCase()&&!t.toLowerCase().includes(i.toLowerCase()))),a=r.slice(0,Math.min(3,r.length)).join(", "),c=r.slice(Math.min(3,r.length)).join(", ");return{title:h(l+a+(c?`, ${c}`:"")),explanation:"Style-first template highlighting design aesthetic"}}o.addEventListener("input",(function(){i.textContent=this.value.length,this.value.length>140?i.style.color="red":i.style.color="#757575"})),n&&n.addEventListener("click",a),e&&e.addEventListener("keypress",(function(t){"Enter"===t.key&&(a(),t.preventDefault())})),s&&s.addEventListener("click",(function(){if(0===tags.length)return void alert("Please add at least one tag to generate title suggestions.");const t=o.value.trim(),e=document.getElementById("productDescription").value.trim(),n=function(t,e,n){const o=[...e].sort(((t,e)=>{const n=t.split(" ").length,o=e.split(" ").length;return n>1&&1===o?-1:1===n&&o>1?1:t.length-e.length})),i=t?d(t):[],s=n?d(n):[];let l=[g(o,i,s),m(o,i,s),f(o,i,s),p(o,i,s)].filter(Boolean);return l=l.map((t=>{let e=function(t){const e=function(t){const e=t.toLowerCase().replace(/[^\w\s]/g," ").split(/\s+/).filter((t=>t.length>2)),n={};e.forEach((t=>{n[t]=(n[t]||0)+1}));const o=Object.keys(n).filter((t=>n[t]>2)).map((t=>({word:t,count:n[t]})));return{hasExcessiveRepetition:o.length>0,repeatedWords:o,wordFrequency:n}}(t);if(!e.hasExcessiveRepetition)return t;let n=t;return e.repeatedWords.forEach((({word:t,count:e})=>{if(e>2){const e=new RegExp(`\\b${t}\\b`,"gi"),o=[...n.matchAll(e)];if(o.length>2)for(let e=o.length-1;e>=2;e--){const i=o[e].index,s=i+t.length,l=n.lastIndexOf(",",i)+1||0,r=n.indexOf(",",s),a=n.substring(l,r>-1?r:n.length).trim();if(a.split(/\s+/).length>1){const t=n.charAt(i-1),e=n.charAt(s);n=" "===t&&" "===e?n.slice(0,i)+n.slice(s+1):" "===t?n.slice(0,i-1)+n.slice(s):n.slice(0,i)+n.slice(s)}else if(a.toLowerCase()===t.toLowerCase()){const t=n.indexOf(",",l);n=-1===t?n.slice(0,l?l-1:0):n.slice(0,l?l-1:0)+n.slice(t)}}}})),n}(t.title);const n=u(e);let o=function(t,e=6){if(u(t)<=e)return t;let n=-1,o=0;for(let i=0;i<t.length;i++)if(","===t[i]&&(o++,o===e)){n=i;break}if(-1!==n)return t.substring(0,n+1)+t.substring(n+1).replace(/,/g,"");return t}(e);const i=n>6,s=o.length;let l=function(t,e=140){if(t.length<=e)return t;const n=t.lastIndexOf(",",e);if(-1!==n&&n>.75*e)return t.substring(0,n);{let n=t.substring(0,e);const o=n.lastIndexOf(" ");return-1!==o&&o>.9*e&&(n=n.substring(0,o)),n}}(o);const r=s>140;let a=t.explanation;return e!==t.title&&(a+=" (repetition removed)"),i&&(a+=" (commas limited to 6)"),r&&(a+=" (truncated to 140 chars)"),{...t,title:l,explanation:a}})),l}(t,tags,e);!function(t){if(l.innerHTML="<h3>Optimized Title Suggestions</h3>",0===t.length)return void(l.innerHTML+="<p>Unable to generate title suggestions. Please add more descriptive tags.</p>");t.forEach(((t,e)=>{const n=document.createElement("div");n.className="title-result";const o=document.createElement("button");o.className="copy-btn",o.textContent="Copy",o.addEventListener("click",(function(){navigator.clipboard.writeText(t.title).then((()=>{this.textContent="Copied!",setTimeout((()=>{this.textContent="Copy"}),2e3)}))}));const i=`\n                        <div>\n                            <strong>Option ${e+1}:</strong><br>\n                            <span class="first-60">${t.title.slice(0,60)}</span>${t.title.slice(60)}\n                        </div>\n                        <div class="char-count">${t.title.length}/140 characters</div>\n                        <p><em>${t.explanation}</em></p>\n                    `;n.innerHTML=i,n.appendChild(o),l.appendChild(n)}));const e=document.createElement("div");e.className="tip",e.innerHTML='\n                    <h3>Title Tips</h3>\n                    <ul>\n                        <li>Choose the title that best describes your product while maintaining keyword focus</li>\n                        <li>All titles place important keywords in the first 60 characters (highlighted in blue)</li>\n                        <li>Consider adding seasonal keywords if relevant (e.g., "Valentine\'s Gift", "Christmas Decoration")</li>\n                        <li>Remember to update your tags to match keywords in your title</li>\n                    </ul>\n                ',l.appendChild(e)}(n),switchTab("results-tab",document.querySelector(".tab:nth-child(2)"))}))}));